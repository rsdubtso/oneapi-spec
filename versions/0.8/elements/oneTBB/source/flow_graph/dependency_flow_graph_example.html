

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Dependency Flow Graph Example &mdash; oneAPI Specification 0.8 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../../../_static/favicons.png"/>
  
  
  

  
  <script type="text/javascript" src="../../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
        <script src="../../../../_static/jquery.js"></script>
        <script src="../../../../_static/underscore.js"></script>
        <script src="../../../../_static/doctools.js"></script>
        <script src="../../../../_static/language_data.js"></script>
        <script src="../../../../_static/custom.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/graphviz.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/custom.css" type="text/css" />
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
    <link rel="next" title="Message Flow Graph Example" href="message_flow_graph_example.html" />
    <link rel="prev" title="tagged_msg" href="tagged_msg_cls.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="https://oneapi.com" class="icon icon-home"> oneAPI Specification
          

          
            
            <img src="../../../../_static/oneAPI-rgb-rev-100.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                0.8
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../architecture.html">Software Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../library-interop.html">Library Interoperability</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../elements.html">oneAPI Elements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../dpcpp/source/index.html">DPC++</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../oneDPL/source/index.html">oneDPL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../oneDNN/source/index.html">oneDNN</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../oneCCL/source/index.html">oneCCL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../l0/source/index.html">Level Zero</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../oneDAL/source/index.html">oneDAL</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../nested-index.html">oneTBB</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../nested-gen-info.html">General Information</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../nested-interfaces.html">oneTBB Interfaces</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../configuration.html">Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="../algorithms.html">Algorithms</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../flow_graph.html">Flow Graph</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="../flow_graph.html#graph-class">Graph Class</a></li>
<li class="toctree-l4"><a class="reference internal" href="../flow_graph.html#nodes">Nodes</a></li>
<li class="toctree-l4"><a class="reference internal" href="../flow_graph.html#ports-and-edges">Ports and Edges</a></li>
<li class="toctree-l4"><a class="reference internal" href="../flow_graph.html#special-messages-types">Special Messages Types</a></li>
<li class="toctree-l4 current"><a class="reference internal" href="../flow_graph.html#examples">Examples</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../task_scheduler.html">Task Scheduler</a></li>
<li class="toctree-l3"><a class="reference internal" href="../containers.html">Containers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../thread_local_storage.html">Thread Local Storage</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../nested-aux-interfaces.html">oneTBB Auxiliary Interfaces</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../oneVPL/source/index.html">oneVPL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../oneMKL/source/index.html">oneMKL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../contributors.html">Contributors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../versions.html">HTML and PDF Versions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../notices.html">Legal Notices and Disclaimers</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">oneAPI Specification</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../index.html">oneAPI Specification</a> &raquo;</li>
        
          
          <li><a href="../nested-index.html">oneTBB</a> </li>
          
        
          
        
          
        
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/oneapi-src/oneapi-spec/blob/master/source/elements/oneTBB/source/flow_graph/dependency_flow_graph_example.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="dependency-flow-graph-example">
<h1>Dependency Flow Graph Example<a class="headerlink" href="#dependency-flow-graph-example" title="Permalink to this headline">¶</a></h1>
<p>In the following example, five computations A-E are set up with the
partial ordering shown below in “A simple dependency graph.”. For each edge in
the flow graph, the node at the tail of the edge must complete its execution
before the node at the head may begin.</p>
<div class="figure align-center" id="id1">
<a class="reference internal image-reference" href="../../../../_images/dep_graph.jpg"><img alt="../../../../_images/dep_graph.jpg" src="../../../../_images/dep_graph.jpg" style="width: 249px; height: 409px;" /></a>
<p class="caption"><span class="caption-text">A simple dependency graph.</span><a class="headerlink" href="#id1" title="Permalink to this image">¶</a></p>
</div>
<div class="code cpp highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#include &lt;cstdio&gt;</span>
<span class="c1">#include &quot;tbb/flow_graph.h&quot;</span>

<span class="n">using</span> <span class="n">namespace</span> <span class="n">tbb</span><span class="p">::</span><span class="n">flow</span><span class="p">;</span>

<span class="n">struct</span> <span class="n">body</span> <span class="p">{</span>
    <span class="n">std</span><span class="p">::</span><span class="n">string</span> <span class="n">my_name</span><span class="p">;</span>
    <span class="n">body</span><span class="p">(</span><span class="n">const</span> <span class="n">char</span> <span class="o">*</span><span class="n">name</span><span class="p">)</span> <span class="p">:</span> <span class="n">my_name</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="p">{}</span>
    <span class="n">void</span> <span class="n">operator</span><span class="p">()(</span><span class="n">continue_msg</span><span class="p">)</span> <span class="n">const</span> <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">my_name</span><span class="o">.</span><span class="n">c_str</span><span class="p">());</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="nb">int</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">graph</span> <span class="n">g</span><span class="p">;</span>

    <span class="n">broadcast_node</span><span class="o">&lt;</span> <span class="n">continue_msg</span> <span class="o">&gt;</span> <span class="n">start</span><span class="p">(</span><span class="n">g</span><span class="p">);</span>
    <span class="n">continue_node</span><span class="o">&lt;</span><span class="n">continue_msg</span><span class="o">&gt;</span> <span class="n">a</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">body</span><span class="p">(</span><span class="s2">&quot;A&quot;</span><span class="p">));</span>
    <span class="n">continue_node</span><span class="o">&lt;</span><span class="n">continue_msg</span><span class="o">&gt;</span> <span class="n">b</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">body</span><span class="p">(</span><span class="s2">&quot;B&quot;</span><span class="p">));</span>
    <span class="n">continue_node</span><span class="o">&lt;</span><span class="n">continue_msg</span><span class="o">&gt;</span> <span class="n">c</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">body</span><span class="p">(</span><span class="s2">&quot;C&quot;</span><span class="p">));</span>
    <span class="n">continue_node</span><span class="o">&lt;</span><span class="n">continue_msg</span><span class="o">&gt;</span> <span class="n">d</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">body</span><span class="p">(</span><span class="s2">&quot;D&quot;</span><span class="p">));</span>
    <span class="n">continue_node</span><span class="o">&lt;</span><span class="n">continue_msg</span><span class="o">&gt;</span> <span class="n">e</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">body</span><span class="p">(</span><span class="s2">&quot;E&quot;</span><span class="p">));</span>

    <span class="n">make_edge</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">a</span><span class="p">);</span>
    <span class="n">make_edge</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">b</span><span class="p">);</span>
    <span class="n">make_edge</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">c</span><span class="p">);</span>
    <span class="n">make_edge</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">);</span>
    <span class="n">make_edge</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">);</span>
    <span class="n">make_edge</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">e</span><span class="p">);</span>

    <span class="k">for</span> <span class="p">(</span><span class="nb">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">start</span><span class="o">.</span><span class="n">try_put</span><span class="p">(</span><span class="n">continue_msg</span><span class="p">());</span>
        <span class="n">g</span><span class="o">.</span><span class="n">wait_for_all</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>In this example, nodes A-E print out their names. All of these nodes are
therefore able to use <code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">body</span></code> to construct their body objects.</p>
<p>In function <code class="docutils literal notranslate"><span class="pre">main</span></code>, the flow graph is set up once and then run three times. All of the nodes in
this example pass around <code class="docutils literal notranslate"><span class="pre">continue_msg</span></code> objects. This type is used to communicate that a node has
completed its execution.</p>
<p>The first line in function <code class="docutils literal notranslate"><span class="pre">main</span></code> instantiates a <code class="docutils literal notranslate"><span class="pre">graph</span></code> object, <code class="docutils literal notranslate"><span class="pre">g</span></code>. On the next line, a
<code class="docutils literal notranslate"><span class="pre">broadcast_node</span></code> named <code class="docutils literal notranslate"><span class="pre">start</span></code> is created. Anything passed to this node will be
broadcast to all of its successors. The node <code class="docutils literal notranslate"><span class="pre">start</span></code> is used in the <code class="docutils literal notranslate"><span class="pre">for</span></code> loop at the bottom of
<code class="docutils literal notranslate"><span class="pre">main</span></code> to launch the execution of the rest of the flow graph.</p>
<p>In the example, five <code class="docutils literal notranslate"><span class="pre">continue_node</span></code> objects are created, named a - e. Each node is constructed
with a reference to <code class="docutils literal notranslate"><span class="pre">graph</span></code> <code class="docutils literal notranslate"><span class="pre">g</span></code> and the function object to invoke when it runs. The
successor / predecessor relationships are set up by the <code class="docutils literal notranslate"><span class="pre">make_edge</span></code> calls that follow the
declaration of the nodes.</p>
<p>After the nodes and edges are set up, the <code class="docutils literal notranslate"><span class="pre">try_put</span></code> in each iteration of the <code class="docutils literal notranslate"><span class="pre">for</span></code> loop results
in a broadcast of a <code class="docutils literal notranslate"><span class="pre">continue_msg</span></code> to both <code class="docutils literal notranslate"><span class="pre">a</span></code> and <code class="docutils literal notranslate"><span class="pre">b</span></code>. Both <code class="docutils literal notranslate"><span class="pre">a</span></code> and <code class="docutils literal notranslate"><span class="pre">b</span></code> are waiting for a
single <code class="docutils literal notranslate"><span class="pre">continue_msg</span></code>, since they both have only a single predecessor, <code class="docutils literal notranslate"><span class="pre">start</span></code>.</p>
<p>When they receive the message from <code class="docutils literal notranslate"><span class="pre">start</span></code>, they execute their body objects. When complete,
they each forward a <code class="docutils literal notranslate"><span class="pre">continue_msg</span></code> to their successors, and so on. The graph
uses tasks to execute the node bodies as well as to forward messages between
the nodes, allowing computation to execute concurrently when possible.</p>
<p>See also:</p>
<ul class="simple">
<li><p><a class="reference internal" href="continue_msg_cls.html"><span class="doc">continue_msg class</span></a></p></li>
<li><p><a class="reference internal" href="continue_node_cls.html"><span class="doc">continue_node class</span></a></p></li>
</ul>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="message_flow_graph_example.html" class="btn btn-neutral float-right" title="Message Flow Graph Example" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="tagged_msg_cls.html" class="btn btn-neutral float-left" title="tagged_msg" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Intel Corporation

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>