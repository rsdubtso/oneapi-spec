

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>parallel_pipeline &mdash; oneAPI Specification 0.8 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../../../../_static/favicons.png"/>
  
  
  

  
  <script type="text/javascript" src="../../../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../../" src="../../../../../_static/documentation_options.js"></script>
        <script src="../../../../../_static/jquery.js"></script>
        <script src="../../../../../_static/underscore.js"></script>
        <script src="../../../../../_static/doctools.js"></script>
        <script src="../../../../../_static/language_data.js"></script>
        <script src="../../../../../_static/custom.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../../../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../_static/graphviz.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../_static/custom.css" type="text/css" />
    <link rel="index" title="Index" href="../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../search.html" />
    <link rel="next" title="filter" href="parallel_pipeline_func/filter_cls.html" />
    <link rel="prev" title="parallel_invoke" href="parallel_invoke_func.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="https://oneapi.com" class="icon icon-home"> oneAPI Specification
          

          
            
            <img src="../../../../../_static/oneAPI-rgb-rev-100.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                0.8
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../../../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../architecture.html">Software Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../library-interop.html">Library Interoperability</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../elements.html">oneAPI Elements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../dpcpp/source/index.html">DPC++</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../oneDPL/source/index.html">oneDPL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../oneDNN/source/index.html">oneDNN</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../oneCCL/source/index.html">oneCCL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../l0/source/index.html">Level Zero</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../oneDAL/source/index.html">oneDAL</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../nested-index.html">oneTBB</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../nested-gen-info.html">General Information</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../nested-interfaces.html">oneTBB Interfaces</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../../configuration.html">Configuration</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../../algorithms.html">Algorithms</a><ul class="current">
<li class="toctree-l4 current"><a class="reference internal" href="../../algorithms.html#parallel-functions">Parallel Functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../algorithms.html#blocked-ranges">Blocked Ranges</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../algorithms.html#partitioners">Partitioners</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../algorithms.html#split-tags">Split Tags</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../flow_graph.html">Flow Graph</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../task_scheduler.html">Task Scheduler</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../containers.html">Containers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../thread_local_storage.html">Thread Local Storage</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../nested-aux-interfaces.html">oneTBB Auxiliary Interfaces</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../oneVPL/source/index.html">oneVPL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../oneMKL/source/index.html">oneMKL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../contributors.html">Contributors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../versions.html">HTML and PDF Versions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../notices.html">Legal Notices and Disclaimers</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../index.html">oneAPI Specification</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../../index.html">oneAPI Specification</a> &raquo;</li>
        
          
          <li><a href="../../nested-index.html">oneTBB</a> </li>
          
        
          
        
          
        
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/oneapi-src/oneapi-spec/blob/master/source/elements/oneTBB/source/algorithms/functions/parallel_pipeline_func.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="parallel-pipeline">
<h1>parallel_pipeline<a class="headerlink" href="#parallel-pipeline" title="Permalink to this headline">¶</a></h1>
<p><strong>[algorithms.parallel_pipeline]</strong></p>
<p>Strongly-typed interface for pipelined execution.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Defined in header &lt;tbb/parallel_pipeline.h&gt;</span>

<span class="k">namespace</span> <span class="n">tbb</span> <span class="p">{</span>

    <span class="kt">void</span> <span class="n">parallel_pipeline</span><span class="p">(</span> <span class="kt">size_t</span> <span class="n">max_number_of_live_tokens</span><span class="p">,</span> <span class="k">const</span> <span class="n">filter</span><span class="o">&lt;</span><span class="kt">void</span><span class="p">,</span><span class="kt">void</span><span class="o">&gt;&amp;</span> <span class="n">filter_chain</span> <span class="p">);</span>
    <span class="kt">void</span> <span class="nf">parallel_pipeline</span><span class="p">(</span> <span class="kt">size_t</span> <span class="n">max_number_of_live_tokens</span><span class="p">,</span> <span class="k">const</span> <span class="n">filter</span><span class="o">&lt;</span><span class="kt">void</span><span class="p">,</span><span class="kt">void</span><span class="o">&gt;&amp;</span> <span class="n">filter_chain</span><span class="p">,</span> <span class="n">task_group_context</span><span class="o">&amp;</span> <span class="n">group</span> <span class="p">);</span>

<span class="p">}</span> <span class="c1">// namespace tbb</span>
</pre></div>
</div>
<p>A <code class="docutils literal notranslate"><span class="pre">parallel_pipeline</span></code> algorithm represents pipelined application of a series of filters to a stream of items.
Each filter operates in a particular mode: parallel, serial in-order, or serial out-of-order.</p>
<p>To build and run a pipeline from functors <em>g</em><sub>0</sub>, <em>g</em><sub>1</sub>, <em>g</em><sub>2</sub>, …, <em>g</em><sub>n</sub>, write:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">parallel_pipeline</span><span class="p">(</span> <span class="n">max_number_of_live_tokens</span><span class="p">,</span>
                   <span class="n">make_filter</span><span class="o">&lt;</span><span class="kt">void</span><span class="p">,</span><span class="n">I1</span><span class="o">&gt;</span><span class="p">(</span><span class="n">mode0</span><span class="p">,</span><span class="n">g0</span><span class="p">)</span> <span class="o">&amp;</span>
                   <span class="n">make_filter</span><span class="o">&lt;</span><span class="n">I1</span><span class="p">,</span><span class="n">I2</span><span class="o">&gt;</span><span class="p">(</span><span class="n">mode1</span><span class="p">,</span><span class="n">g1</span><span class="p">)</span> <span class="o">&amp;</span>
                   <span class="n">make_filter</span><span class="o">&lt;</span><span class="n">I2</span><span class="p">,</span><span class="n">I3</span><span class="o">&gt;</span><span class="p">(</span><span class="n">mode2</span><span class="p">,</span><span class="n">g2</span><span class="p">)</span> <span class="o">&amp;</span>
                   <span class="p">...</span>
                   <span class="n">make_filter</span><span class="o">&lt;</span><span class="n">In</span><span class="p">,</span><span class="kt">void</span><span class="o">&gt;</span><span class="p">(</span><span class="n">moden</span><span class="p">,</span><span class="n">gn</span><span class="p">)</span> <span class="p">);</span>
</pre></div>
</div>
<p>In general, functor <em>g</em><sub>i</sub> should define its <code class="docutils literal notranslate"><span class="pre">operator()</span></code> to map objects of type
<em>I</em><sub>i</sub> to objects of type <em>I</em><sub>i+1</sub>. Functor <em>g</em><sub>0</sub> is a special case, because
it notifies the pipeline when the end of an input stream is reached. Functor <em>g</em><sub>0</sub> must
be defined such that for a <em>flow_control</em> object <em>fc</em>, the expression <em>g</em><sub>0</sub> (<em>fc</em> ) either
returns the next value in an input stream, or if at the end of an input stream, invokes <em>fc.stop()</em>
and returns a dummy value.</p>
<p>Each <cite>filter</cite> should be specified by two template arguments. These arguments define filters input
and output types. The first and last filters are special cases. Input type of the first filter must be <cite>void</cite>,
output type of the last filter must be <cite>void</cite> too.</p>
<p>Before passing to <cite>parallel_pipeline</cite> all filters must be concatenated to one(<code class="docutils literal notranslate"><span class="pre">filter&lt;void,</span> <span class="pre">void&gt;</span></code>)
by <cite>filter::opeartor&amp;()</cite>. Operator <cite>&amp;</cite> requires that the second template argument of its left operand matches
the first template argument of its second operand.</p>
<p>The number of items processed in parallel depends upon the structure of the pipeline and number of available threads.
<em>max_number_of_live_tokens</em> sets the threshold for concurrently processed items.</p>
<p>If the <em>group</em> argument is specified, pipeline’s tasks are executed in this group. By default the algorithm
is executed in a bound group of its own.</p>
<div class="section" id="example">
<h2>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h2>
<p>The following example uses <code class="docutils literal notranslate"><span class="pre">parallel_pipeline</span></code> compute the root-mean-square of a sequence defined
by [ <em>first</em> , <em>last</em> ).</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">float</span> <span class="nf">RootMeanSquare</span><span class="p">(</span> <span class="kt">float</span><span class="o">*</span> <span class="n">first</span><span class="p">,</span> <span class="kt">float</span><span class="o">*</span> <span class="n">last</span> <span class="p">)</span> <span class="p">{</span>
    <span class="kt">float</span> <span class="n">sum</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
    <span class="n">parallel_pipeline</span><span class="p">(</span> <span class="cm">/*max_number_of_live_token=*/</span><span class="mi">16</span><span class="p">,</span>
        <span class="n">make_filter</span><span class="o">&lt;</span><span class="kt">void</span><span class="p">,</span><span class="kt">float</span><span class="o">*&gt;</span><span class="p">(</span>
            <span class="n">filter</span><span class="o">::</span><span class="n">serial</span><span class="p">,</span>
            <span class="p">[</span><span class="o">&amp;</span><span class="p">](</span><span class="n">flow_control</span><span class="o">&amp;</span> <span class="n">fc</span><span class="p">)</span><span class="o">-&gt;</span> <span class="kt">float</span><span class="o">*</span><span class="p">{</span>
                <span class="k">if</span><span class="p">(</span> <span class="n">first</span><span class="o">&lt;</span><span class="n">last</span> <span class="p">)</span> <span class="p">{</span>
                    <span class="k">return</span> <span class="n">first</span><span class="o">++</span><span class="p">;</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="n">fc</span><span class="p">.</span><span class="n">stop</span><span class="p">();</span>
                    <span class="k">return</span> <span class="k">nullptr</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">)</span> <span class="o">&amp;</span>
        <span class="n">make_filter</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">*</span><span class="p">,</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span>
            <span class="n">filter</span><span class="o">::</span><span class="n">parallel</span><span class="p">,</span>
            <span class="p">[](</span><span class="kt">float</span><span class="o">*</span> <span class="n">p</span><span class="p">){</span><span class="k">return</span> <span class="p">(</span><span class="o">*</span><span class="n">p</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="o">*</span><span class="n">p</span><span class="p">);}</span>
        <span class="p">)</span> <span class="o">&amp;</span>
        <span class="n">make_filter</span><span class="o">&lt;</span><span class="kt">float</span><span class="p">,</span><span class="kt">void</span><span class="o">&gt;</span><span class="p">(</span>
            <span class="n">filter</span><span class="o">::</span><span class="n">serial</span><span class="p">,</span>
            <span class="p">[</span><span class="o">&amp;</span><span class="p">](</span><span class="kt">float</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span><span class="n">sum</span><span class="o">+=</span><span class="n">x</span><span class="p">;}</span>
        <span class="p">)</span>
    <span class="p">);</span>
    <span class="k">return</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">sum</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="filter-class-template">
<h2>filter Class Template<a class="headerlink" href="#filter-class-template" title="Permalink to this headline">¶</a></h2>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="parallel_pipeline_func/filter_cls.html">filter</a><ul>
<li class="toctree-l2"><a class="reference internal" href="parallel_pipeline_func/filter_mode_enum.html">filter_mode</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div class="section" id="flow-control-class">
<h2>flow_control Class<a class="headerlink" href="#flow-control-class" title="Permalink to this headline">¶</a></h2>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="parallel_pipeline_func/flow_control_cls.html">flow_control</a></li>
</ul>
</div>
<p>See also:</p>
<ul class="simple">
<li><p><a class="reference internal" href="../../task_scheduler/scheduling_controls/task_group_context_cls.html"><span class="doc">task_group_context</span></a></p></li>
</ul>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="parallel_pipeline_func/filter_cls.html" class="btn btn-neutral float-right" title="filter" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="parallel_invoke_func.html" class="btn btn-neutral float-left" title="parallel_invoke" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Intel Corporation

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>