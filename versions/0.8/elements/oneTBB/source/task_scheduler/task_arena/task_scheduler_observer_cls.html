

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>task_scheduler_observer &mdash; oneAPI Specification 0.8 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../../../../_static/favicons.png"/>
  
  
  

  
  <script type="text/javascript" src="../../../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../../" src="../../../../../_static/documentation_options.js"></script>
        <script src="../../../../../_static/jquery.js"></script>
        <script src="../../../../../_static/underscore.js"></script>
        <script src="../../../../../_static/doctools.js"></script>
        <script src="../../../../../_static/language_data.js"></script>
        <script src="../../../../../_static/custom.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../../../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../_static/graphviz.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../_static/custom.css" type="text/css" />
    <link rel="index" title="Index" href="../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../search.html" />
    <link rel="next" title="Containers" href="../../containers.html" />
    <link rel="prev" title="this_task_arena" href="this_task_arena_ns.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="https://oneapi.com" class="icon icon-home"> oneAPI Specification
          

          
            
            <img src="../../../../../_static/oneAPI-rgb-rev-100.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                0.8
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../../../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../architecture.html">Software Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../library-interop.html">Library Interoperability</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../elements.html">oneAPI Elements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../dpcpp/source/index.html">DPC++</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../oneDPL/source/index.html">oneDPL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../oneDNN/source/index.html">oneDNN</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../oneCCL/source/index.html">oneCCL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../l0/source/index.html">Level Zero</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../oneDAL/source/index.html">oneDAL</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../nested-index.html">oneTBB</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../nested-gen-info.html">General Information</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../nested-interfaces.html">oneTBB Interfaces</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../../configuration.html">Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../algorithms.html">Algorithms</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../flow_graph.html">Flow Graph</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../../task_scheduler.html">Task Scheduler</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="../../task_scheduler.html#scheduling-controls">Scheduling controls</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../task_scheduler.html#task-group">Task Group</a></li>
<li class="toctree-l4 current"><a class="reference internal" href="../../task_scheduler.html#task-arena">Task Arena</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../containers.html">Containers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../thread_local_storage.html">Thread Local Storage</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../nested-aux-interfaces.html">oneTBB Auxiliary Interfaces</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../oneVPL/source/index.html">oneVPL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../oneMKL/source/index.html">oneMKL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../contributors.html">Contributors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../versions.html">HTML and PDF Versions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../notices.html">Legal Notices and Disclaimers</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../index.html">oneAPI Specification</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../../index.html">oneAPI Specification</a> &raquo;</li>
        
          
          <li><a href="../../nested-index.html">oneTBB</a> </li>
          
        
          
        
          
        
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/oneapi-src/oneapi-spec/blob/master/source/elements/oneTBB/source/task_scheduler/task_arena/task_scheduler_observer_cls.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="task-scheduler-observer">
<h1>task_scheduler_observer<a class="headerlink" href="#task-scheduler-observer" title="Permalink to this headline">¶</a></h1>
<p><strong>[scheduler.task_scheduler_observer]</strong></p>
<p>Class that represents thread’s interest in task scheduling services.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Defined in header &lt;tbb/task_scheduler_observer.h&gt;</span>

<span class="k">namespace</span> <span class="n">tbb</span> <span class="p">{</span>

   <span class="k">class</span> <span class="nc">task_scheduler_observer</span> <span class="p">{</span>
   <span class="k">public</span><span class="o">:</span>
       <span class="n">task_scheduler_observer</span><span class="p">();</span>
       <span class="k">explicit</span> <span class="nf">task_scheduler_observer</span><span class="p">(</span> <span class="n">task_arena</span><span class="o">&amp;</span> <span class="n">a</span> <span class="p">);</span>
       <span class="k">virtual</span> <span class="o">~</span><span class="n">task_scheduler_observer</span><span class="p">();</span>

       <span class="kt">void</span> <span class="nf">observe</span><span class="p">(</span> <span class="kt">bool</span> <span class="n">state</span><span class="o">=</span><span class="nb">true</span> <span class="p">);</span>
       <span class="kt">bool</span> <span class="nf">is_observing</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>

       <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">on_scheduler_entry</span><span class="p">(</span> <span class="kt">bool</span> <span class="n">is_worker</span> <span class="p">)</span> <span class="p">{}</span>
       <span class="k">virtual</span> <span class="kt">void</span> <span class="n">on_scheduler_exit</span><span class="p">(</span> <span class="kt">bool</span> <span class="n">is_worker</span> <span class="p">}</span> <span class="p">{}</span>
   <span class="p">};</span>

<span class="p">}</span>
</pre></div>
</div>
<p>A <code class="docutils literal notranslate"><span class="pre">task_scheduler_observer</span></code> permits clients to observe when a thread starts
and stops processing tasks, either globally or in a certain task scheduler arena.
You typically derive your own observer class from <code class="docutils literal notranslate"><span class="pre">task_scheduler_observer</span></code>, and override
virtual methods <code class="docutils literal notranslate"><span class="pre">on_scheduler_entry</span></code> or <code class="docutils literal notranslate"><span class="pre">on_scheduler_exit</span></code>.
Observation can be enabled and disabled for an observer instance; it is disabled on creation.
Remember to call <code class="docutils literal notranslate"><span class="pre">observe()</span></code> to enable observation.</p>
<p>Exceptions thrown and not caught in the overridden methods of <code class="docutils literal notranslate"><span class="pre">task_scheduler_observer</span></code> result in undefined behavior.</p>
<div class="section" id="member-functions">
<h2>Member functions<a class="headerlink" href="#member-functions" title="Permalink to this headline">¶</a></h2>
<dl class="cpp function">
<dt id="_CPPv423task_scheduler_observerv">
<span id="_CPPv323task_scheduler_observerv"></span><span id="_CPPv223task_scheduler_observerv"></span><span id="task_scheduler_observer"></span><code class="sig-name descname">task_scheduler_observer</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#_CPPv423task_scheduler_observerv" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Constructs a <code class="docutils literal notranslate"><span class="pre">task_scheduler_observer</span></code> object in the inactive state (observation is disabled).
For a created observer, entry/exit notifications are invoked whenever a worker
thread joins/leaves the arena of the observer’s owner thread. If a thread is
already in the arena when the observer is activated, the entry notification is
called before it executes the first stolen task.</p>
</dd></dl>

<dl class="cpp function">
<dt id="_CPPv423task_scheduler_observerR10task_arena">
<span id="_CPPv323task_scheduler_observerR10task_arena"></span><span id="_CPPv223task_scheduler_observerR10task_arena"></span><span id="task_scheduler_observer__task_arenaR"></span><em class="property">explicit</em> <code class="sig-name descname">task_scheduler_observer</code><span class="sig-paren">(</span><a class="reference internal" href="task_arena_cls.html#_CPPv410task_arenaij" title="task_arena">task_arena</a>&amp;<span class="sig-paren">)</span><a class="headerlink" href="#_CPPv423task_scheduler_observerR10task_arena" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Construct <code class="docutils literal notranslate"><span class="pre">task_scheduler_observer</span></code> object for a given arena in inactive state (observation is disabled).
For created observer, entry/exit notifications are invoked whenever a thread joins/leaves arena.
If a thread is already in the arena when the observer is activated, the entry notification
is called before it executes the first stolen task.</p>
<p>Constructs a <code class="docutils literal notranslate"><span class="pre">task_scheduler_observer</span></code> object in the inactive state (observation is disabled),
which receives notifications from threads entering and exiting the specified <code class="docutils literal notranslate"><span class="pre">task_arena</span></code>.</p>
</dd></dl>

<dl class="cpp function">
<dt id="_CPPv4D0v">
<span id="_CPPv3D0v"></span><span id="_CPPv2D0v"></span><span id="~task_scheduler_observer"></span><code class="sig-name descname">~task_scheduler_observer</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#_CPPv4D0v" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Disables observing and destroys the observer instance.
Waits for extant invocations of <code class="docutils literal notranslate"><span class="pre">on_scheduler_entry</span></code> and <code class="docutils literal notranslate"><span class="pre">on_scheduler_exit</span></code> to complete.</p>
</dd></dl>

<dl class="cpp function">
<dt id="_CPPv47observeb">
<span id="_CPPv37observeb"></span><span id="_CPPv27observeb"></span><span id="observe__b"></span>void <code class="sig-name descname">observe</code><span class="sig-paren">(</span>bool <em>state</em> = true<span class="sig-paren">)</span><a class="headerlink" href="#_CPPv47observeb" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Enables observing if <code class="docutils literal notranslate"><span class="pre">state</span></code> is true; disables observing if <code class="docutils literal notranslate"><span class="pre">state</span></code> is false.</p>
</dd></dl>

<dl class="cpp function">
<dt id="_CPPv4NK12is_observingEv">
<span id="_CPPv3NK12is_observingEv"></span><span id="_CPPv2NK12is_observingEv"></span><span id="is_observingC"></span>bool <code class="sig-name descname">is_observing</code><span class="sig-paren">(</span><span class="sig-paren">)</span> <em class="property">const</em><a class="headerlink" href="#_CPPv4NK12is_observingEv" title="Permalink to this definition">¶</a><br /></dt>
<dd><p><strong>Returns</strong>: True if observing is enabled; false otherwise.</p>
</dd></dl>

<dl class="cpp function">
<dt id="_CPPv418on_scheduler_entryb">
<span id="_CPPv318on_scheduler_entryb"></span><span id="_CPPv218on_scheduler_entryb"></span><span id="on_scheduler_entry__b"></span><em class="property">virtual</em> void <code class="sig-name descname">on_scheduler_entry</code><span class="sig-paren">(</span>bool <em>is_worker</em><span class="sig-paren">)</span><a class="headerlink" href="#_CPPv418on_scheduler_entryb" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>The task scheduler invokes this method for each thread that starts participating
in oneTBB work or enters an arena after the observation is enabled.
For threads that already execute tasks, the method is invoked
before executing the first task stolen after enabling the observation.</p>
<p>If a thread enables the observation and then spawns a task, it is guaranteed that the task,
as well as all the tasks it creates, will be executed by threads which have invoked <code class="docutils literal notranslate"><span class="pre">on_scheduler_entry</span></code>.</p>
<p>The flag <code class="docutils literal notranslate"><span class="pre">is_worker</span></code> is true if the thread was created by oneTBB; false otherwise.</p>
<p><strong>Effects</strong>: The default behavior does nothing.</p>
</dd></dl>

<dl class="cpp function">
<dt id="_CPPv417on_scheduler_exitb">
<span id="_CPPv317on_scheduler_exitb"></span><span id="_CPPv217on_scheduler_exitb"></span><span id="on_scheduler_exit__b"></span><em class="property">virtual</em> void <code class="sig-name descname">on_scheduler_exit</code><span class="sig-paren">(</span>bool <em>is_worker</em><span class="sig-paren">)</span><a class="headerlink" href="#_CPPv417on_scheduler_exitb" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>The task scheduler invokes this method when
a thread stops participating in task processing or leaves an arena.</p>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>A process does not wait for the worker threads to clean up,
and can terminate before <code class="docutils literal notranslate"><span class="pre">on_scheduler_exit</span></code> is invoked.</p>
</div>
<p><strong>Effects</strong>: The default behavior does nothing.</p>
</dd></dl>

</div>
<div class="section" id="example">
<h2>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h2>
<p>The following example sketches the code of an observer that pins oneTBB worker threads to hardware threads.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">pinning_observer</span> <span class="o">:</span> <span class="k">public</span> <span class="n">tbb</span><span class="o">::</span><span class="n">task_scheduler_observer</span> <span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
    <span class="n">affinity_mask_t</span> <span class="n">m_mask</span><span class="p">;</span> <span class="c1">// HW affinity mask to be used for threads in an arena</span>
    <span class="n">pinning_observer</span><span class="p">(</span> <span class="n">tbb</span><span class="o">::</span><span class="n">task_arena</span> <span class="o">&amp;</span><span class="n">a</span><span class="p">,</span> <span class="n">affinity_mask_t</span> <span class="n">mask</span> <span class="p">)</span>
        <span class="o">:</span> <span class="n">tbb</span><span class="o">::</span><span class="n">task_scheduler_observer</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">m_mask</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">observe</span><span class="p">(</span><span class="nb">true</span><span class="p">);</span> <span class="c1">// activate the observer</span>
    <span class="p">}</span>
    <span class="kt">void</span> <span class="n">on_scheduler_entry</span><span class="p">(</span> <span class="kt">bool</span> <span class="n">worker</span> <span class="p">)</span> <span class="k">override</span> <span class="p">{</span>
        <span class="n">set_thread_affinity</span><span class="p">(</span><span class="n">tbb</span><span class="o">::</span><span class="n">this_task_arena</span><span class="o">::</span><span class="n">current_thread_index</span><span class="p">(),</span> <span class="n">m_mask</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="kt">void</span> <span class="n">on_scheduler_exit</span><span class="p">(</span> <span class="kt">bool</span> <span class="n">worker</span> <span class="p">)</span> <span class="k">override</span> <span class="p">{</span>
        <span class="n">restore_thread_affinity</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">};</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../../containers.html" class="btn btn-neutral float-right" title="Containers" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="this_task_arena_ns.html" class="btn btn-neutral float-left" title="this_task_arena" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Intel Corporation

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>