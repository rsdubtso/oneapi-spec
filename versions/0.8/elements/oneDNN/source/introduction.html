

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Introduction &mdash; oneAPI Specification 0.8 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../../_static/favicons.png"/>
  
  
  

  
  <script type="text/javascript" src="../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/language_data.js"></script>
        <script src="../../../_static/custom.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/graphviz.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Conventions" href="conventions.html" />
    <link rel="prev" title="oneDNN" href="index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="https://oneapi.com" class="icon icon-home"> oneAPI Specification
          

          
            
            <img src="../../../_static/oneAPI-rgb-rev-100.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                0.8
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../architecture.html">Software Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../library-interop.html">Library Interoperability</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../elements.html">oneAPI Elements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dpcpp/source/index.html">DPC++</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../oneDPL/source/index.html">oneDPL</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">oneDNN</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Introduction</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#general-api-notes">General API notes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#error-handling">Error Handling</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="conventions.html">Conventions</a></li>
<li class="toctree-l2"><a class="reference internal" href="execution_model/index.html">Execution Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="data_model/index.html">Data model</a></li>
<li class="toctree-l2"><a class="reference internal" href="primitives/index.html">Primitives</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id1">Open Source Implementation</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#implementation-notes">Implementation Notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#testing">Testing</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../oneCCL/source/index.html">oneCCL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../l0/source/index.html">Level Zero</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../oneDAL/source/index.html">oneDAL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../oneTBB/source/nested-index.html">oneTBB</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../oneVPL/source/index.html">oneVPL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../oneMKL/source/index.html">oneMKL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contributors.html">Contributors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../versions.html">HTML and PDF Versions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../notices.html">Legal Notices and Disclaimers</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">oneAPI Specification</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">oneAPI Specification</a> &raquo;</li>
        
          
          <li><a href="index.html">oneDNN</a> </li>
          
        
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/oneapi-src/oneapi-spec/blob/master/source/elements/oneDNN/source/introduction.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="introduction">
<span id="introduction-label"></span><h1>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">Â¶</a></h1>
<p>Although the origins of this specification are in the existing <a class="reference external" href="https://github.com/oneapi-src/oneDNN/tree/dev-v2">open source
implementation</a>, its goal is to define a <em>portable</em> set of APIs.  To this
end, for example, it intentionally omits implementation-specific details like
tiled or blocked memory formats (layouts), and instead describes plain
multi-dimensional memory formats and defines opaque <em>optimized</em> memory format
that can be implementation specific.</p>
<p>oneDNN main concepts are <em>primitives</em>, <em>engines</em> and <em>streams</em>.</p>
<a class="reference internal image-reference" href="../../../_images/img_programming_model.png"><img alt="oneDNN programming model" src="../../../_images/img_programming_model.png" style="width: 600px;" /></a>
<p>A <em>primitive</em> (<a class="reference internal" href="primitives/general.html#_CPPv4N4dnnl9primitiveE" title="dnnl::primitive"><code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">dnnl::primitive</span></code></a>) is a functor object that
encapsulates a particular computation such as forward convolution, backward
LSTM computations, or a data transformation operation. A single primitive can
sometimes represent more complex <em>fused</em> computations such as a forward
convolution followed by a ReLU. Fusion, among other things, is controlled via
the <em>primitive attrubutes</em> mechanism.</p>
<p>The most important difference between a primitive and a pure function is that
a primitive can be specialized for a subset of input parameters.</p>
<p>For example, a convolution primitive stores parameters like tensor shapes and
can pre-compute other dependent parameters like cache blocking. This approach
allows oneDNN primitives to pre-generate code specifically tailored for the
operation to be performed. The oneDNN programming model assumes that the time
it takes to perform the pre-computations is amortized by reusing the same
primitive to perform computations multiple times.</p>
<p>A primitive may also need a mutable memory buffer that it may use for
temporary storage only during computations. Such buffer is called a
scratchpad. It can either be owned by a primitive object (which makes that
object non-thread safe) or be an execution-time parameter.</p>
<p>Primitive creation is a potentially expensive operation. Users are expected to
create primitives once and reuse them multiple times. Alternatively,
implementations may reduce the primitive creation cost by caching primitives
that have the same parameters. This optimization falls outside of the scope of
this specification.</p>
<p><em>Engines</em> (<a class="reference internal" href="execution_model/index.html#_CPPv4N4dnnl6engineE" title="dnnl::engine"><code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">dnnl::engine</span></code></a>) are an abstraction of a computational
device: a CPU, a specific GPU card in the system, etc. Most primitives are
created to execute computations on one specific engine. The only exceptions
are reorder primitives that transfer data between two different engines.</p>
<p><em>Streams</em> (<a class="reference internal" href="execution_model/index.html#_CPPv4N4dnnl6streamE" title="dnnl::stream"><code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">dnnl::stream</span></code></a>) encapsulate execution context tied to a
particular engine. For example, they can correspond to DPC++ command queues.</p>
<p>Memory objects (<a class="reference internal" href="data_model/memory/objects.html#_CPPv4N4dnnl6memoryE" title="dnnl::memory"><code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">dnnl::memory</span></code></a>) encapsulate handles to memory
allocated on a specific engine, tensor dimensions, data type, and memory
format â the way tensor indices map to offsets in linear memory space. Memory
objects are passed to primitives during execution.</p>
<p class="rubric">Levels of Abstraction</p>
<p>oneDNN has multiple levels of abstractions for primitives and memory objects
in order to expose maximum flexibility to its users.</p>
<p>On the logical level, the library provides the following abstractions:</p>
<ul class="simple">
<li><p>Memory descriptors (<a class="reference internal" href="data_model/memory/objects.html#_CPPv4N4dnnl6memory4descE" title="dnnl::memory::desc"><code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">dnnl::memory::desc</span></code></a>) define a tensorâs logical
dimensions, data type, and the format in which the data is laid out in
memory. The special format any (<a class="reference internal" href="data_model/memory/formats.html#_CPPv4N4dnnl6memory10format_tag3anyE" title="dnnl::memory::format_tag::any"><code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">dnnl::memory::format_tag::any</span></code></a>)
indicates that the actual format will be defined later.</p></li>
<li><p>Operation descriptors (one for each supported primitive) describe an
operationâs most basic properties without specifying, for example, which
engine will be used to compute them. For example, convolution descriptor
describes shapes of source, destination, and weights tensors, propagation
kind (forward, backward with respect to data or weights), and other
implementation-independent parameters.</p></li>
<li><p>Primitive descriptors (<a class="reference internal" href="primitives/general.html#_CPPv4N4dnnl19primitive_desc_baseE" title="dnnl::primitive_desc_base"><code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">dnnl::primitive_desc_base</span></code></a> is the base class
and each of the supported primitives have their own version) are at an
abstraction level in between operation descriptors and primitives and can be
used to inspect details of a specific primitive implementation like expected
memory formats via queries to implement memory format propagation (see
Memory format propagation) without having to fully instantiate a primitive.</p></li>
</ul>
<table class="docutils align-default">
<colgroup>
<col style="width: 39%" />
<col style="width: 28%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Abstraction level</p></th>
<th class="head"><p>Memory object</p></th>
<th class="head"><p>Primitive objects</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Logical description</p></td>
<td><p>Memory descriptor</p></td>
<td><p>Operation descriptor</p></td>
</tr>
<tr class="row-odd"><td><p>Intermediate description</p></td>
<td><p>N/A</p></td>
<td><p>Primitive descriptor</p></td>
</tr>
<tr class="row-even"><td><p>Implementation</p></td>
<td><p>Memory object</p></td>
<td><p>Primitive</p></td>
</tr>
</tbody>
</table>
<div class="section" id="general-api-notes">
<h2>General API notes<a class="headerlink" href="#general-api-notes" title="Permalink to this headline">Â¶</a></h2>
<p>There are certain assumptions on how oneDNN objects behave:</p>
<ul class="simple">
<li><p>Memory and operation descriptors behave similarly to trivial types.</p></li>
<li><p>All other objects behave like shared pointers. Copying is always shallow.</p></li>
</ul>
<p>oneDNN objects can be <em>empty</em> in which case they are not valid for any use.
Memory descriptors are special in this regard, as their empty versions are
regarded as <em>zero</em> memory descriptors that can be used to indicate absence of
a memory descriptor. Empty objects are usually created using default
constructors, but also may be a result of an error during object construction
(see the next section).</p>
</div>
<div class="section" id="error-handling">
<h2>Error Handling<a class="headerlink" href="#error-handling" title="Permalink to this headline">Â¶</a></h2>
<p>All oneDNN functions throw the following exception in case of error.</p>
<dl class="cpp struct">
<dt id="_CPPv4N4dnnl5errorE">
<span id="_CPPv3N4dnnl5errorE"></span><span id="_CPPv2N4dnnl5errorE"></span><span id="dnnl::error"></span><span class="target" id="structdnnl_1_1error"></span><em class="property">struct </em><code class="sig-name descname">error</code> : <em class="property">public</em> exception<a class="headerlink" href="#_CPPv4N4dnnl5errorE" title="Permalink to this definition">Â¶</a><br /></dt>
<dd><p>The exception class. </p>
</dd></dl>

<p>Additionally, many oneDNN functions that construct or return oneDNN objects
have a boolean <code class="docutils literal notranslate"><span class="pre">allow_empty</span></code> parameter that defaults to <code class="docutils literal notranslate"><span class="pre">false</span></code> and that
makes the library to return an empty object (a zero object in case of memory
descriptors) when an object cannot be constructed instead of throwing an
error.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="conventions.html" class="btn btn-neutral float-right" title="Conventions" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral float-left" title="oneDNN" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Intel Corporation

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>